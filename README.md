## buildInstaller ##

Last modified: 4 June 2008


### Summary ###

buildInstaller is a command-line, Python script to generate user-friendly FLW installers for your [FontLab Studio](http://fontlab.com) Python scripts, macros and modules. Thanks to the FLW installer users do not have to copy the files to the FontLab or Python file structure manually or use command-line installers for more complicated projects.
The buildInstaller script only needs a simple configuration file to know which files from your development file structure will be included in the generated installer and where these files should go when installed.

If you want to find out easily what this can do, try the example installer.


### License ###

buildInstaller was originally developed for [Tiro Typeworks](http://www.tiro.ca), but it has been significantly extended and is distributed for free now.
Redistribution and use of the script is limited by the BSD licence:
[BSD licence](http://creativecommons.org/licenses/BSD/)

*If you use it commercially, be nice and buy me a drink at ATypI or anywhere else we might meet. Any suggestions for improvements are welcome.*


### What is a FLW installer? ###

FLW files are Python scripts with ``.flw`` extension. They are assigned to FontLab Studio by default, hence when user opens the FLW file (e.g. by double-clicking) it is opened in FontLab and executed as a common macro. FLW installer stands for a FLW file which contains macros within itself and can copy them out, when executed by FontLab, in order to install them on the user’s computer (the originator of this approach is [Tim Ahrens](http://justanotherfoundry.com/)).


### What can the generated FLW installers do? ###

The installers generated by the buildInstaller script have several important features:
* they work equally well on Windows and Mac (in general).
* the installer can contain text files as well as binary files, any file type.
* the files can be bundled in one or more bundles. When installing, users can select which bundles to install from a dialog.
* the files included are categorized into three groups: "macros", "modules" and "site-packages".
* under "macros" are files which will be installed to the FontLab's ``Macros`` folder (current user's folder is used)
* under "modules" are files to be installed to ``System/Modules/`` subfolder of the FontLab's Macros folder. This is where shared modules used by your macros should go, if they are used only in FontLab.
* under "site-packages" are files to be installed in Python's site-packages directory. This is where modules accessed by your python scripts should go, if they are used outside FontLab as well.
* paths to the folders containing modules need to be added to the Python environment. This is done by adding the module folders under ``modules-paths`` and ``site-packages-paths`` (see the configuration file for more information)
* the installer contains a licence. Users have to agree with the licence in order to proceed.
* the installer uses FontLab’s Python, so there is no risk of installing macros and modules to a different version of Python on the user’s computer.


### How to install buildInstaller ###

1. Copy buildInstaller.py anywhere you want to use it (possibly to folder which is in your PATH).
2. The script requires [PyYAML](http://pyyaml.org/). PyYAML is a YAML parser and emitter and it is very very easy to install. It is used to parse the configuration file.
3. You are done.


### How to use the buildInstaller ###

There are several ways:
* when you are in the same directory:\\ ``$ python buildInstaller.py configuration.yaml generatedInstaller.flw``\\ ``$ ./buildInstaller.py configuration.yaml generatedInstaller.flw``
* when the script is in your PATH environment:\\ ``$ buildInstaller.py configuration.yaml generatedInstaller.flw``

The script takes two arguments: first is the path to the configuration file, second is the name (and path) of the to-be-generated FLW installer.


### How prepare the configuration file ###

//Following is the contents of the examplatory YAML configuration file with detailed description of its syntax. (for YAML specification see http://www.yaml.org/)//
This file configures a new FLW installer when used together with the buildInstaller script.

<code>
# The indentation defines the scope of the structures (btw. YAML is sensitive regarding tabs, see http://www.yaml.org/faq.html)
# 1. name of the installer (used in dialogs' titles)
name: The installer
# 2. text of your licence. Users have to confirm the licence in order to proceed.
# Note: the line breaks and indentation (not the initial level, though) are kept in the dialog (initial "|" is crucial for this).
licence: |
    text of your licence
    you want to show in the dialog
    newlines are transfered to the dialog
        and further levels
        of indentation as well
    the space for the text is limited
    by fixed width of the dialog
    and height of the screen (no scrollbar available)
# 3. the files included in the installer are divided into several bundles
# from which user can choose what to install. Bundles are further divided
# into "macros", "modules" and "site-packages".
# "site-packages-paths" and "modules-paths" define which paths should be
# added to the Python environment.
bundles:
    # 4. bundle name (used in the dialog)
    MyFirstBundle:
        # 5. macros: following files will be copied to
        # the target subfolder in FL's Macros folder
        # Format used is: <current path to file>: <target subfolder of the Macros folder when istalled>
        # Note: the paths should be relative to this file and should be in the convention of the OS you are using.
        macros:
            /current/path/to/file.py: target_subfolder
            /current/path/to/file.txt: target_subfolder
            /current/path/to/file.xp3: target_subfolder
        # 6. modules: following files will be copied to
        # the target subfolder in FL's Macros/System/Modules/ folder.
        # Use these for modules you access from the FL macros.
        # format used is: <current path to file>: <target subfolder of the Macros/System/Modules/ folder when istalled>
        modules:
            /current/path/to/file.py: target_subfolder
            /current/path/to/file.txt: target_subfolder
            /current/path/to/file.xp3: target_subfolder
        # 6a. modules-paths: paths to module folders which should be added to
        # the Python environment in order to make the contained modules work.
        # These are usually base folders of the modules added above.
        # Format used is: <path name>: <path to the folder>
        # Note: <path name> is used for the name of the .pth file when adding to the Python environment
        modules-paths:
            targetSubfolder: target_subfolder
        # 7. site-packages: following files will be copied to the target
        # subfolder in site-packages folder of Python. Use this for modules
        # used in your macros and other scripts independent on FontLab.
        # Format used is: <current path to file>: <target subfolder when istalled>
        site-packages:
            /current/path/to/file.py: target_subfolder2/
            /current/path/to/file.txt: /target_subfolder2/
            /current/path/to/file.xp3: /target_subfolder2
        # 7a. site-packages-paths: paths to site-package folders which should be added to
        # the Python environment in order to make the contained modules work.
        # These are usually base folders of the site-packages added above.
        # Format used is: <path name>: <path to the folder>
        site-packages-paths:
            targetSubfolder: target_subfolder2
    MySecondBundle:
        # Note that there is not any fixed section order or any obligatory arguments.
        # However, it is devisable to add the modules' base folder to modules-paths/site-packages-paths.
        modules:
            /current/path/to/file.py: target_subfolder
            /current/path/to/file.txt: target_subfolder
            /current/path/to/file.xp3: target_subfolder
        macros:
            /current/path/to/file.py: "." # directly to the FL Macros folder
            /current/path/to/file.txt: target_subfolder
            /current/path/to/file.xp3: target_subfolder
        modules-paths:
            MyModule: target_subfolder
</code>



### Example ###

The example.zip contains all files necessary to build an examplatory installer (including two bundles with macros and modules, and configuration file) and the built FLW installer.

The dialogs should look like these:

{{:scripts:dialog1.png|First dialog of the installation sequence}}
{{:scripts:dialog2.png|Second dialog of the installation sequence}}
{{:scripts:dialog3.png|Final dialog of the installation sequence}}


### Regarding the size ###

Produced FLW installers can be quite large because the encoding method actually doubles the size of the bundled content, however, zip can effectively make them small again.
